See [source comments](format.php) for explanations. 
